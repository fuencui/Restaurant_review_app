{"ast":null,"code":"import _createForOfIteratorHelper from\"/Users/fuencui/Desktop/1fuen-cui-project3/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";import _objectSpread from\"/Users/fuencui/Desktop/1fuen-cui-project3/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"/Users/fuencui/Desktop/1fuen-cui-project3/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/fuencui/Desktop/1fuen-cui-project3/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/Users/fuencui/Desktop/1fuen-cui-project3/node_modules/@babel/runtime/regenerator/index.js\";import axios from'axios';import React,{useState,useEffect}from'react';import{useParams}from'react-router';import NavBar from'./NavBar';import{Button,Offcanvas,InputGroup,FormControl}from\"react-bootstrap\";import{useNavigate}from\"react-router-dom\";import'./DishDetail.css';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function DishDetail(props){var _useState=useState(undefined),_useState2=_slicedToArray(_useState,2),dish=_useState2[0],setDish=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),commentList=_useState4[0],setCommentList=_useState4[1];var _useState5=useState({username:null,comment:'',rank:'',dishId:null}),_useState6=_slicedToArray(_useState5,2),comment=_useState6[0],setComment=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),show=_useState8[0],setShow=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),showComment=_useState10[0],setShowComment=_useState10[1];var handleClose=function handleClose(){return setShow(false);};var handleShow=function handleShow(){return setShow(true);};var handleCloseComment=function handleCloseComment(){return setShowComment(false);};var handleShowComment=function handleShowComment(){return setShowComment(true);};var param=useParams();var navigate=useNavigate();useEffect(function(){function fetchData(){return _fetchData.apply(this,arguments);}function _fetchData(){_fetchData=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var id;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axios.get('/api/dish/'+param.dishId).then(function(response){setDish(response.data);setComment(_objectSpread(_objectSpread({},comment),{},{dishId:param.dishId}));return param.dishId;}).catch(function(error){return console.log(\"cannot find dish\");});case 2:id=_context.sent;_context.next=5;return axios.get('/api/user/isLoggedIn').then(function(response){return setComment(_objectSpread(_objectSpread({},comment),{},{dishId:id,username:response.data.username}));}).catch(function(error){return console.log(\"User is not logged in \");});case 5:case\"end\":return _context.stop();}}},_callee);}));return _fetchData.apply(this,arguments);}fetchData();findAllComment();},[setComment,setCommentList,setDish]);function findAllComment(){axios.get('/api/comment/Id/'+param.dishId).then(function(response){setCommentList(response.data);}).catch(function(e){return console.log(e);});}function postComment(){return _postComment.apply(this,arguments);}function _postComment(){_postComment=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;if(!(comment.username&&comment.dishId)){_context2.next=5;break;}_context2.next=4;return axios.post('/api/comment',comment).then(function(commentResponse){console.log(commentResponse);}).catch(function(e){return console.log(e);});case 4:setShow(false);case 5:_context2.next=10;break;case 7:_context2.prev=7;_context2.t0=_context2[\"catch\"](0);console.log(_context2.t0);case 10:_context2.prev=10;averageAllRating();findAllComment();return _context2.finish(10);case 14:case\"end\":return _context2.stop();}}},_callee2,null,[[0,7,10,14]]);}));return _postComment.apply(this,arguments);}if(!dish){return/*#__PURE__*/_jsx(\"div\",{children:\"Dish not found\"});}function base64ToImage(dish){if(dish.base64!=='null'){return/*#__PURE__*/_jsx(\"img\",{className:\"img\",src:dish.base64});}else{return/*#__PURE__*/_jsx(\"h1\",{children:\"Image Not Exists\"});}}function handleDeleteReview(){return _handleDeleteReview.apply(this,arguments);}function _handleDeleteReview(){_handleDeleteReview=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return axios.delete('/api/comment/deleteAll/'+param.dishId).then(function(res){return console.log('detele all');}).catch(function(e){return console.log(e);});case 3:_context3.next=5;return axios.delete('/api/dish/deleteDish/'+param.dishId).then(function(res){return navigate('/dish');}).catch(function(e){return console.log(e);});case 5:_context3.next=10;break;case 7:_context3.prev=7;_context3.t0=_context3[\"catch\"](0);console.log(_context3.t0);case 10:case\"end\":return _context3.stop();}}},_callee3,null,[[0,7]]);}));return _handleDeleteReview.apply(this,arguments);}function handleDeleteComment(){return _handleDeleteComment.apply(this,arguments);}function _handleDeleteComment(){_handleDeleteComment=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.prev=0;_context4.next=3;return axios.delete('/api/comment/deleteUsernameAndDishId/'+param.dishId+'/'+dish.username).then(function(res){return console.log(res);}).catch(function(e){return console.log(e);});case 3:_context4.next=8;break;case 5:_context4.prev=5;_context4.t0=_context4[\"catch\"](0);console.log(_context4.t0);case 8:_context4.prev=8;findAllComment();return _context4.finish(8);case 11:case\"end\":return _context4.stop();}}},_callee4,null,[[0,5,8,11]]);}));return _handleDeleteComment.apply(this,arguments);}function handleEdit(){return _handleEdit.apply(this,arguments);}function _handleEdit(){_handleEdit=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.prev=0;_context5.next=3;return axios.put('/api/comment/updateComment/'+param.dishId+'/'+dish.username,comment).then(function(res){return console.log(res);}).catch(function(e){return console.log(e);});case 3:_context5.next=8;break;case 5:_context5.prev=5;_context5.t0=_context5[\"catch\"](0);console.log(_context5.t0);case 8:_context5.prev=8;findAllComment();setShowComment(false);averageAllRating();return _context5.finish(8);case 13:case\"end\":return _context5.stop();}}},_callee5,null,[[0,5,8,13]]);}));return _handleEdit.apply(this,arguments);}function averageAllRating(){return _averageAllRating.apply(this,arguments);}function _averageAllRating(){_averageAllRating=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(){var numberOfuser,ratingTotal,newRate,_iterator2,_step2,rate;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:if(dish){_context6.next=2;break;}return _context6.abrupt(\"return\");case 2:numberOfuser=commentList.length+2;ratingTotal=parseInt(dish.rank)+parseInt(comment.rank);newRate=dish.rank;try{_iterator2=_createForOfIteratorHelper(commentList);try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){rate=_step2.value;ratingTotal+=rate.rank;}}catch(err){_iterator2.e(err);}finally{_iterator2.f();}}catch(e){console.log(e);}finally{newRate=ratingTotal/numberOfuser;axios.put('/api/dish/'+param.dishId,{rank:newRate}).then(function(res){return console.log(res);}).catch(function(e){return console.log(e);});}return _context6.abrupt(\"return\",setDish(_objectSpread(_objectSpread({},dish),{},{rank:newRate})));case 7:case\"end\":return _context6.stop();}}},_callee6);}));return _averageAllRating.apply(this,arguments);}function ableToDetele(){if(comment.username===dish.username){return/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(Button,{variant:\"success\",size:\"sm\",style:{backgroundColor:'#70a9a1',border:'0px'},onClick:handleDeleteReview,children:\"Detele This Review\"})});}}function ableToDeteleCommentEdit(username){if(username===comment.username){return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Button,{variant:\"success\",size:\"sm\",style:{backgroundColor:'#70a9a1',border:'0px'},onClick:handleDeleteComment,children:\"Detele Comment\"}),/*#__PURE__*/_jsx(Button,{variant:\"success\",size:\"sm\",style:{backgroundColor:'#70a9a1',border:'0px'},onClick:handleShowComment,children:\"Edit Comment\"}),/*#__PURE__*/_jsxs(Offcanvas,{show:showComment,onHide:handleCloseComment,children:[/*#__PURE__*/_jsx(Offcanvas.Header,{closeButton:true,children:/*#__PURE__*/_jsxs(Offcanvas.Title,{children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-egg-fried\"}),\"Edit A Comment\"]})}),/*#__PURE__*/_jsxs(Offcanvas.Body,{children:[/*#__PURE__*/_jsxs(InputGroup,{size:\"sm\",className:\"mb-3\",children:[/*#__PURE__*/_jsx(InputGroup.Text,{id:\"inputGroup-sizing-sm\",children:\"Comment\"}),/*#__PURE__*/_jsx(FormControl,{type:\"text\",value:comment.comment,onChange:function onChange(e){setComment(_objectSpread(_objectSpread({},comment),{},{comment:e.target.value}));},\"aria-label\":\"Small\",\"aria-describedby\":\"inputGroup-sizing-sm\"})]}),/*#__PURE__*/_jsxs(InputGroup,{size:\"sm\",className:\"mb-3\",children:[/*#__PURE__*/_jsx(InputGroup.Text,{id:\"inputGroup-sizing-sm\",children:\"Rank\"}),/*#__PURE__*/_jsx(FormControl,{type:\"number\",value:comment.rank,min:\"0\",max:\"5\",step:\"0.5\",onChange:function onChange(e){setComment(_objectSpread(_objectSpread({},comment),{},{rank:e.target.value}));},\"aria-label\":\"Small\",\"aria-describedby\":\"inputGroup-sizing-sm\"})]}),/*#__PURE__*/_jsx(Button,{variant:\"primary\",size:\"sm\",onClick:handleEdit,style:{backgroundColor:'#90be6d',border:'0px'},children:\"Edit Comment\"})]})]})]});}}function abltToReview(){if(comment.username!=null){return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Button,{variant:\"success\",style:{backgroundColor:'#70a9a1',border:'0px'},onClick:handleShow,children:\"Write a Comment\"}),/*#__PURE__*/_jsxs(Offcanvas,{show:show,onHide:handleClose,children:[/*#__PURE__*/_jsx(Offcanvas.Header,{closeButton:true,children:/*#__PURE__*/_jsxs(Offcanvas.Title,{children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-egg-fried\"}),\"Write a Comment\"]})}),/*#__PURE__*/_jsxs(Offcanvas.Body,{children:[/*#__PURE__*/_jsxs(InputGroup,{size:\"sm\",className:\"mb-3\",children:[/*#__PURE__*/_jsx(InputGroup.Text,{id:\"inputGroup-sizing-sm\",children:\"Comment\"}),/*#__PURE__*/_jsx(FormControl,{type:\"text\",value:comment.comment,onChange:function onChange(e){setComment(_objectSpread(_objectSpread({},comment),{},{comment:e.target.value}));},\"aria-label\":\"Small\",\"aria-describedby\":\"inputGroup-sizing-sm\"})]}),/*#__PURE__*/_jsxs(InputGroup,{size:\"sm\",className:\"mb-3\",children:[/*#__PURE__*/_jsx(InputGroup.Text,{id:\"inputGroup-sizing-sm\",children:\"Rank\"}),/*#__PURE__*/_jsx(FormControl,{type:\"number\",value:comment.rank,min:\"0\",max:\"5\",step:\"0.5\",onChange:function onChange(e){setComment(_objectSpread(_objectSpread({},comment),{},{rank:e.target.value}));},\"aria-label\":\"Small\",\"aria-describedby\":\"inputGroup-sizing-sm\"})]}),/*#__PURE__*/_jsx(Button,{variant:\"primary\",size:\"lg\",onClick:postComment,style:{backgroundColor:'#90be6d',border:'0px'},children:\"Post Comment\"})]})]})]});}else{return/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(Button,{variant:\"success\",style:{backgroundColor:'#70a9a1',border:'0px'},children:\"Login To Write A Review\"})});}}var dishDetailComponent=[];var _iterator=_createForOfIteratorHelper(commentList),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var _comment=_step.value;dishDetailComponent.push(/*#__PURE__*/_jsxs(\"div\",{className:\"commentContainer\",children:[/*#__PURE__*/_jsxs(\"h3\",{children:[\"Username: \",_comment.username]}),/*#__PURE__*/_jsxs(\"h3\",{children:[\"Commennt: \",_comment.comment]}),/*#__PURE__*/_jsxs(\"h3\",{children:[\"Rank: \",_comment.rank]}),ableToDeteleCommentEdit(_comment.username)]},_comment._id));}}catch(err){_iterator.e(err);}finally{_iterator.f();}return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(NavBar,{}),/*#__PURE__*/_jsxs(\"div\",{className:\"mainDetailContainer\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"buttonMid\",children:abltToReview()}),/*#__PURE__*/_jsxs(\"div\",{className:\"reviewContainer\",children:[base64ToImage(dish),/*#__PURE__*/_jsxs(\"h3\",{children:[\"Username: \",dish.username]}),/*#__PURE__*/_jsxs(\"h3\",{children:[\"Average Rank: \",dish.rank]}),ableToDetele()]},dish._id),dishDetailComponent]})]});}","map":{"version":3,"sources":["/Users/fuencui/Desktop/1fuen-cui-project3/src/DishDetail.jsx"],"names":["axios","React","useState","useEffect","useParams","NavBar","Button","Offcanvas","InputGroup","FormControl","useNavigate","DishDetail","props","undefined","dish","setDish","commentList","setCommentList","username","comment","rank","dishId","setComment","show","setShow","showComment","setShowComment","handleClose","handleShow","handleCloseComment","handleShowComment","param","navigate","fetchData","get","then","response","data","catch","error","console","log","id","findAllComment","e","postComment","post","commentResponse","averageAllRating","base64ToImage","base64","handleDeleteReview","delete","res","handleDeleteComment","handleEdit","put","numberOfuser","length","ratingTotal","parseInt","newRate","rate","ableToDetele","backgroundColor","border","ableToDeteleCommentEdit","target","value","abltToReview","dishDetailComponent","push","_id"],"mappings":"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","sourcesContent":["import axios from 'axios';\nimport React, {useState, useEffect} from 'react';\nimport { useParams } from 'react-router';\nimport NavBar from './NavBar';\nimport { Button, Offcanvas ,InputGroup ,FormControl} from \"react-bootstrap\";\nimport { useNavigate } from \"react-router-dom\";\nimport './DishDetail.css';\n\nexport default function DishDetail(props){\n    const[dish, setDish] = useState(undefined);\n    const[commentList, setCommentList] = useState([]);\n    const [comment, setComment] = useState({\n        username: null,\n        comment: '',\n        rank: '',\n        dishId: null,\n    })\n    const [show, setShow] = useState(false);\n    const [showComment, setShowComment] = useState(false);\n    const handleClose = () => setShow(false);\n    const handleShow = () => setShow(true);\n    const handleCloseComment = () => setShowComment(false);\n    const handleShowComment = () => setShowComment(true);\n    const param = useParams();\n    const navigate = useNavigate();\n\n    useEffect(() => {\n        async function fetchData() {\n            const id = await axios.get('/api/dish/' + param.dishId)\n            .then(function(response){\n                setDish(response.data);\n                setComment({...comment, dishId: param.dishId})\n                return param.dishId;\n            })\n            .catch(error => console.log(\"cannot find dish\"))\n\n            await axios.get('/api/user/isLoggedIn')\n            .then(response => setComment({...comment, dishId: id,username:response.data.username}))\n            .catch(error => console.log(\"User is not logged in \"))\n          }\n        fetchData();\n        findAllComment();\n        } ,[setComment,setCommentList,setDish] );\n\n    function findAllComment() {\n        axios.get('/api/comment/Id/' + param.dishId)\n            .then(function(response){\n                setCommentList(response.data);\n            })\n            .catch(e => console.log(e));\n    }\n\n\n    async function postComment(){\n        try {\n            if (comment.username && comment.dishId){\n                await axios.post('/api/comment', comment)\n                .then((commentResponse) => {\n                console.log(commentResponse)})\n                .catch(e => console.log(e));\n                setShow(false);\n            }\n        } catch (e) {\n            console.log(e);\n        } finally{\n            averageAllRating();\n            findAllComment();\n        }\n    }\n\n    if (!dish){\n        return (<div>\n            Dish not found\n        </div>)\n    }\n\n    function base64ToImage(dish){\n        if(dish.base64 !== 'null'){\n            return <img className='img' src={dish.base64}></img>\n        } else {\n            return <h1>Image Not Exists</h1>;\n        }\n    } \n\n    async function handleDeleteReview(){\n        try {\n            await axios.delete('/api/comment/deleteAll/' + param.dishId)\n            .then(res => console.log('detele all'))\n            .catch(e => console.log(e));\n            await axios.delete('/api/dish/deleteDish/' + param.dishId)\n            .then(res => navigate('/dish'))\n            .catch(e => console.log(e));\n\n        } catch (e) {\n            console.log(e);\n        }\n    }\n\n    async function handleDeleteComment(){\n        try {\n            await axios.delete('/api/comment/deleteUsernameAndDishId/' + param.dishId + '/' + dish.username)\n            .then(res => console.log(res))\n            .catch(e => console.log(e));\n        } catch (e){\n            console.log(e);\n        } finally {\n            findAllComment();\n        }\n    }\n\n    async function handleEdit(){\n        try {\n            await axios.put('/api/comment/updateComment/' + param.dishId + '/' + dish.username, comment)\n            .then(res => console.log(res))\n            .catch(e => console.log(e));\n        } catch (e){\n            console.log(e);\n        } finally {\n            findAllComment();\n            setShowComment(false);\n            averageAllRating();\n        }\n    }\n\n    async function averageAllRating(){\n        if (!dish) return\n        let numberOfuser = commentList.length + 2;\n        let ratingTotal = parseInt(dish.rank) + parseInt(comment.rank);\n        let newRate = dish.rank;\n        try {\n            for (let rate of commentList){\n                ratingTotal += rate.rank;\n            }\n        } catch (e){\n            console.log(e);\n        } finally {\n            newRate = (ratingTotal/numberOfuser);\n            axios.put('/api/dish/' + param.dishId, {rank:newRate})\n            .then(res => console.log(res))\n            .catch(e => console.log(e));\n        }\n        return setDish({...dish, rank:newRate})\n    }\n\n    function ableToDetele(){\n        if (comment.username === dish.username){\n            return (\n                <div>\n                    <Button variant=\"success\" size='sm' style={{backgroundColor : '#70a9a1', border : '0px'}}onClick={handleDeleteReview}>\n                        Detele This Review\n                    </Button>\n                </div>\n            )\n        }\n    }\n\n    function ableToDeteleCommentEdit(username){\n        if (username === comment.username){\n            return (\n                <div>\n                    <Button variant=\"success\" size='sm' style={{backgroundColor : '#70a9a1', border : '0px'}}onClick={handleDeleteComment}>\n                        Detele Comment\n                    </Button>\n                    \n                    <Button variant=\"success\" size='sm' style={{backgroundColor : '#70a9a1', border : '0px'}}onClick={handleShowComment}>\n                        Edit Comment\n                    </Button>\n                    <Offcanvas show={showComment} onHide={handleCloseComment}>\n                    <Offcanvas.Header closeButton>\n                    <Offcanvas.Title><i className=\"bi bi-egg-fried\"></i>Edit A Comment</Offcanvas.Title>\n                    </Offcanvas.Header>\n                    <Offcanvas.Body>\n            \n                    <InputGroup size=\"sm\" className=\"mb-3\">\n                        <InputGroup.Text id=\"inputGroup-sizing-sm\" >Comment</InputGroup.Text>\n                        <FormControl type='text' value={comment.comment} onChange={e => {setComment({...comment, comment: e.target.value})}} aria-label=\"Small\" aria-describedby=\"inputGroup-sizing-sm\" />\n                    </InputGroup>\n            \n                    <InputGroup size=\"sm\" className=\"mb-3\">\n                    <InputGroup.Text id=\"inputGroup-sizing-sm\">Rank</InputGroup.Text>\n                        <FormControl type='number' value={comment.rank} min=\"0\" max=\"5\" step=\"0.5\" onChange={e => {setComment({...comment, rank: e.target.value})}} aria-label=\"Small\" aria-describedby=\"inputGroup-sizing-sm\" />\n                    </InputGroup>\n                    \n                    <Button variant=\"primary\" size=\"sm\" onClick={handleEdit} style={{backgroundColor : '#90be6d', border: '0px'}}>\n                        Edit Comment\n                    </Button>\n                    </Offcanvas.Body>\n                    </Offcanvas>\n                    </div>\n            )\n        }\n    }\n\n    function abltToReview(){\n        if(comment.username != null){\n            return (\n                <div>\n                <Button variant=\"success\" style={{backgroundColor : '#70a9a1', border : '0px'}}onClick={handleShow}>\n                Write a Comment\n                </Button>\n                <Offcanvas show={show} onHide={handleClose}>\n                <Offcanvas.Header closeButton>\n                  <Offcanvas.Title><i className=\"bi bi-egg-fried\"></i>Write a Comment</Offcanvas.Title>\n                </Offcanvas.Header>\n                <Offcanvas.Body>\n        \n                <InputGroup size=\"sm\" className=\"mb-3\">\n                    <InputGroup.Text id=\"inputGroup-sizing-sm\" >Comment</InputGroup.Text>\n                    <FormControl type='text' value={comment.comment} onChange={e => {setComment({...comment, comment: e.target.value})}} aria-label=\"Small\" aria-describedby=\"inputGroup-sizing-sm\" />\n                </InputGroup>\n        \n                <InputGroup size=\"sm\" className=\"mb-3\">\n                <InputGroup.Text id=\"inputGroup-sizing-sm\">Rank</InputGroup.Text>\n                    <FormControl type='number' value={comment.rank} min=\"0\" max=\"5\" step=\"0.5\" onChange={e => {setComment({...comment, rank: e.target.value})}} aria-label=\"Small\" aria-describedby=\"inputGroup-sizing-sm\" />\n                </InputGroup>\n                \n                <Button variant=\"primary\" size=\"lg\" onClick={postComment} style={{backgroundColor : '#90be6d', border: '0px'}}>\n                    Post Comment\n                </Button>\n                </Offcanvas.Body>\n                </Offcanvas>\n                </div>\n            )\n        } else {\n            return (\n            <div>\n            <Button variant=\"success\" style={{backgroundColor : '#70a9a1', border : '0px'}}>\n                Login To Write A Review\n            </Button>\n            </div>\n            )\n        }\n    }\n\n    const dishDetailComponent = [];\n    for (let comment of commentList){\n        dishDetailComponent.push(\n            <div className='commentContainer' key={comment._id}>\n                <h3>Username: {comment.username}</h3>\n                <h3>Commennt: {comment.comment}</h3>\n                <h3>Rank: {comment.rank}</h3> \n                {ableToDeteleCommentEdit(comment.username)} \n            </div>\n    )}\n\n    return (\n        <div>\n            <NavBar/>\n            <div className='mainDetailContainer'>\n                <div className='buttonMid'>{abltToReview()}</div>\n                <div className='reviewContainer' key={dish._id}>\n                    {base64ToImage(dish)}\n                    <h3>Username: {dish.username}</h3>\n                    <h3>Average Rank: {dish.rank}</h3>\n                    {ableToDetele()}\n                </div>\n                {dishDetailComponent}\n                \n            </div>\n            \n\n        \n        </div>\n    )\n}"]},"metadata":{},"sourceType":"module"}